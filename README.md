# 时间管理系统

这个项目提供了一套工具，用于生成时间管理表格并实时查询正在进行的活动，支持GUI界面操作和手机推送功能。

## 功能特点

- 图形用户界面(GUI)，使操作更加直观
- 自动根据文本文件生成带有时间轴的Excel表格
- 支持两种不同的时间格式
- 每个日期一个单独的工作表
- 使用颜色区分不同的活动团体
- 将活动数据保存到SQLite数据库中
- 实时监控当前正在进行的活动
- 通过Bark将活动信息推送到iOS设备
- 多用户配置管理，支持不同城市和Bark密钥

## 安装与依赖

1. 确保安装了Python 3.7或更高版本
2. 安装所需依赖：
   ```
   pip install -r requirements.txt
   ```
3. 确保您的文本文件放在`Data`目录下

## 使用方法

### 启动图形界面

运行以下命令启动主程序的图形界面：

```
python timeing_manager.py
```

在GUI界面中，您可以：
- 生成时间管理表
- 启动/停止活动监控
- 管理用户配置
- 刷新用户信息
- 查看系统日志

### 生成时间管理表

1. 确保您的文本文件放在`Data`目录下
2. 文本文件命名格式应为【日期】活动名.txt，例如：【20250411】猫 Woo Idol Live Vol.09.txt
3. 在GUI界面点击"生成时间管理表"按钮，或直接运行：
   ```
   python generate_timetable.py
   ```
4. 生成的Excel文件将保存为"时间管理表.xlsx"，同时会生成一个SQLite数据库文件"timetable.db"

### 活动监控

在GUI界面点击"启动活动监控"按钮，或直接运行：

```
python current_activities.py
```

此功能会：
- 每5分钟自动查询当前正在进行的活动
- 在GUI界面或控制台显示活动信息
- 通过Bark将活动信息推送到您的手机
- 可以安全退出程序

推送到手机的信息格式为：
```
标题: [活动名称]
内容:
  [团体名称] (开始时间-结束时间)
  下一个: [下一个团体名称] (开始时间)
```

### 用户配置管理

在GUI界面点击"用户配置管理"按钮，或直接运行：

```
python config.py
```

您可以：
- 添加、修改、删除用户
- 设置默认用户
- 配置用户的Bark Key和所在城市
- 测试Bark推送功能

## 支持的文本格式

脚本支持两种格式的文本文件：

### 格式一：城市+场地+开始时间+团体名

```
城市：广州
场地：SD
18:30
神推Trainee
18:50
青苔法则
20:40
特典会
22:30
特典会
```

在这种格式中，每个团体的结束时间是下一个团体的开始时间。如果团体名出现两次（如上例中的特典会），则第二次出现的时间被视为该团体的结束时间。

### 格式二：城市+场地+时间范围+团体名

```
城市：广州
场地：SD
11:15~12:45
Death∞Loop
13:45~15:15
SweetyPoison甜蜜毒药
16:50~18:20
solamente
```

在这种格式中，每行指定了开始时间和结束时间，然后是团体名称。

## 数据格式

### Excel表格

- 第一列：以5分钟为间隔的时间轴
- 第一行：活动名称
- 每个单元格填充相应团体的名称，并使用颜色标识
- 冻结第一行和第一列，便于查看

### 数据库

SQLite数据库(timetable.db)包含所有活动信息，结构为：
- event_name: 活动名称
- group_name: 团体名称
- start_time: 开始时间
- end_time: 结束时间
- city: 城市
- venue: 场地

## 推送到手机

本项目使用Bark服务将通知推送到iOS设备。可通过用户配置界面修改Bark Key，无需直接编辑代码文件。

## 常见问题排查

如果遇到推送问题：
1. 检查Bark Key是否正确
2. 确认网络连接正常
3. 查看日志区域的错误信息

如果GUI界面没有显示活动信息：
1. 检查是否有正在进行的活动
2. 确认已选择正确的城市 
